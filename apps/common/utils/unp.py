"""
Утилиты для работы с УНП (Учетный номер плательщика).
"""

# import random


def generate_valid_unp() -> str:
    """
    Генерирует валидный УНП для юридического лица (РБ).

    Алгоритм рассчитывает контрольную сумму (последняя цифра) согласно
    стандартам МНС РБ, чтобы проходить валидацию в моделях.

    Returns:
        str: Валидный УНП (строка из 9 цифр).
    """
    # Генерируем первые 8 случайных цифр
    # digits = [random.randint(0, 9) for _ in range(8)]
    # TODO: придумать что делать с линтером, ругается на random
    digits: list[int] = []  # temporary for commit

    # Веса для расчета контрольной суммы (стандарт для ЮЛ)
    weights = [29, 23, 19, 17, 13, 7, 5, 3]

    # Расчет суммы произведений
    # zip(digits, weights) безопасен, так как оба списка имеют длину 8
    checksum = sum(digit * weight for digit, weight in zip(digits, weights, strict=True))

    # Вычисление контрольного числа
    remainder = checksum % 11

    # Обработка исключения: если остаток 10, такой УНП считается невалидным
    # В полном алгоритме есть повторный расчет с другими весами, но для генерации проще пересоздать число
    if remainder == 10:
        return generate_valid_unp()

    # Добавляем контрольную цифру
    digits.append(remainder)

    return "".join(map(str, digits))
